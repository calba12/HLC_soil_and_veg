<<<<<<< HEAD
---
title: "HLC_Veg_Analysis"
author: "Christina Alba"
date: "1/14/2022"
output: html_document
---

```{r libraries, bring in file, some cleaning}

library(knitr); library(multcomp); library(dplyr);library(lme4);library(ggplot2); library(tidyverse); library(ggpubr); library(rstatix);library(writexl);library(ggformula); library(tidyr);library(reshape2)

#Bring in raw data file
veg <- read.csv("Q:/Research/Grants and Funding/HighLineCanalConservancy_2019/7_Project/Stormwater_MovedToQ_UseMe/Data_Analysis/vegetation/Raw Data from RickL/20201204_allHitsData_postQC_prep4.csv")

head(veg)
str(veg)

View(veg)

#change sample bout to a factor

tibble::glimpse(veg)
veg <- veg %>%
  mutate(sample.bout = as.factor(sample.bout))%>%
  mutate(baseline.rep = as.factor(baseline.rep))

str(veg)

## Remove zero from Hit.Number

veg <- veg[veg$Hit.Number != "0",]
View(veg)

#Rename unwieldly columns; remove unwanted columns
vegdf <- veg %>% select(-Number.of.Points.Along.Transect_fromRick) %>%
rename(Num_transect_points = Number.of.points.along.transect_ChrissyCalc)

head(vegdf)
View(vegdf)


```


```{r count hits at each level of organization: canal, baseline, transect}

#Summing number of hits at each level of organization (whole canal, baselines, transects)

#Whole-canal level: number of species hits by sample bout and hit number, includes foliar and ground first hits
df.canal <- vegdf %>% 
  group_by(sample.bout, Hit.Number) %>%
  summarise(Species.Hit = n()) 

View(df.canal)
write_xlsx(df.canal, 'hits_byCanal.xlsx')

#Baseline level: number of species hits by sample bout and hit number, includes foliar and ground first hits
df.baseline <- vegdf %>% 
  group_by(sample.bout, baseline, Hit.Number) %>%
  summarise(Species.Hit = n()) 

View(df.baseline)

write_xlsx(df.baseline, 'hits_byBaseline.xlsx')

#Transect level: number of species hits by sample bout and hit number, includes foliar and ground first hits

df.transect <- vegdf %>% 
  group_by(sample.bout, baseline, baseline.rep, Hit.Number) %>%
  summarise(Species.Hit = n()) 

View(df.transect)

write_xlsx(df.transect, 'hits_byTransect.xlsx')

```


```{r species hits exploration}

#Foliar hits only
#Group species counts by sample bout, hit number, transect, etc.
#Use summarise to count hits by species, drop NA's

veg_only_transect <- vegdf %>%
  group_by(sample.bout, Hit.Number, baseline, Transect, Num_transect_points, Bank_Location, FunctionalGroup, Nativity, Cvalue, WIS, Species.Hit) %>%
  summarise(Species = n()) %>%
  drop_na()

head(veg_only_transect)
View(veg_only_transect)

#This has both sample bouts

write_xlsx(veg_only_transect, 'Species_counts.xlsx')

#Foliar hits only
#summarize species proportions at scale of whole canal, includes all sample bouts and hits
#Used sum(prop_species$Freq) code to count 1909 total hits across whole canal

prop_species_canal <- veg_only_transect %>%
  group_by(Species.Hit) %>%
  summarise(Freq = sum(Species)) %>%
  mutate(prop = Freq/1909)
  
View(prop_species_canal)

sum(prop_species_canal$Freq)

#Foliar hits only
#Now group by bank location, includes all sample bouts and hits

prop_bank <- veg_only_transect %>%
  group_by(Bank_Location) %>%
  summarise(Freq = sum(Species))

View(prop_bank)

sum(prop_bank$Freq)

#Foliar hits only
#Now group by bank location and species, includes all sample bouts and hits

prop_species_bank <- veg_only_transect %>%
  group_by(Species.Hit, Bank_Location) %>%
  summarise(Freq = sum(Species))

View(prop_species_bank)

#Distinct species presence by bank location

distinct_species_bank <- prop_species_bank %>%
  distinct(Bank_Location)%>%
  arrange(desc(Bank_Location))

View(distinct_species_bank)

```


```{r ground hits exploration}

#Ground hits only
#Group species counts by sample bout, hit number, transect, etc.
#Use summarise to count hits by species, drop NA's

ground_only_transect <- vegdf %>%
  group_by(sample.bout, Hit.Number, Bank_Location, baseline, Transect, Num_transect_points, Transect.Point.Soil.Surface) %>%
  summarise(Ground = n()) %>%
  drop_na()

head(ground_only_transect)
View(ground_only_transect)

write_xlsx(ground_only_transect, 'Ground_counts.xlsx')

getwd()

#summarize ground hit proportions at scale of whole canal, includes all sample bouts and hits
#Used sum(prop_ground$Freq) code to count 4664 total hits

prop_ground <- ground_only_transect %>%
  group_by(Transect.Point.Soil.Surface) %>%
  summarise(Freq = sum(Ground)) %>%
  mutate(prop = Freq/4664)
  
View(prop_ground)

sum(prop_ground$Freq)

```


```{r graph WIS}

WIS_baseline <- read.csv("C:/Users/Christina.Alba/.ssh/HLC_soil_and_veg/WIS_baseline_upload.csv")

str(WIS_baseline)
View(WIS_baseline)

#Remove unwanted columns and change to long format

WIS_baseline <- select(WIS_baseline, -Total.Hits, - UPL, -FACU, -FAC, -FACW, -OBL)

WIS_baseline_long <- melt(WIS_baseline, id.vars = c("Baseline","Transect"))

View(WIS_baseline_long)

#add data points w/o jitter 
#Facet by WIS type

WIS_baseline_long %>% ggplot(aes(x=Baseline, y=value)) +
  geom_boxplot()+
  geom_point()+
  theme_bw(base_size=16)+
  facet_wrap(~variable)

#add data points w/o jitter
#Facet by Baseline

WIS_baseline_long %>% ggplot(aes(x=variable, y=value)) +
  geom_boxplot()+
  geom_point()+
  theme_bw(base_size=16)+
  facet_wrap(~Baseline)

#add data points w/o jitter
#Not faceted by baseline; includes all 45 transects

WIS_baseline_long %>% ggplot(aes(x=variable, y=value)) +
  geom_boxplot()+
  geom_point()+
  theme_bw(base_size=16)

```
